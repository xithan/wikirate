"use strict";!function(){function t(){window.clearTimeout(E),E=void 0}function e(t,e){var l=[];return!1!==t.showAllFields?vl.spec.fieldDefs(e).forEach(function(o){var r=n(i(t.fields,o),o,e);l.push(r)}):t.fields&&t.fields.length>0&&t.fields.forEach(function(t){var i=n(t,o(vl.spec.fieldDefs(e),t),e);l.push(i)}),t.fields=l,t}function i(t,e){if(e&&t&&!(t.length<=0))if(e.aggregate){for(i=0;i<t.length;i++)if((o=t[i]).field===e.field&&o.aggregate===e.aggregate)return o;for(i=0;i<t.length;i++)if((o=t[i]).field===e.field&&!o.aggregate)return o}else for(var i=0;i<t.length;i++){var o=t[i];if(o.field===e.field)return o}}function o(t,e){if(e&&e.field&&t)for(var i=0;i<t.length;i++){var o=t[i];if(o.field===e.field){if(!o.aggregate)return o;if(o.aggregate===e.aggregate||!e.aggregate)return o}}}function n(t,e,i){var o=vl.util.extend({},i.config);{if(t||e){!t&&e&&(t={}),t&&!e&&(e={});var n={};if(n.field=e.field?vl.fieldDef.field(e):t.field,"temporal"===e.type&&e.timeUnit){var l=e.field;n.removeOriginalTemporalField=l;for(var r=vl.spec.fieldDefs(i),a=0;a<r.length;a++)if(r[a].field===l&&!r[a].timeUnit){n.removeOriginalTemporalField=void 0;break}}if(o.countTitle||(o.countTitle=vl.config.defaultConfig.countTitle),n.title=t.title?t.title:vl.fieldDef.title(e,o),n.formatType=t.formatType?t.formatType:U[e.type],t.format)n.format=t.format;else switch(n.formatType){case"time":n.format=e.timeUnit?vl.timeUnit.template(e.timeUnit,"",!1).match(/time:'[%-a-z]*'/i)[0].split("'")[1]:o.timeFormat||vl.config.defaultConfig.timeFormat;break;case"number":n.format=o.numberFormat}return e.bin&&(n.field=n.field.replace("_start","_range"),n.bin=!0,n.formatType="string"),n}console.error("[Tooltip] Cannot supplement a field when field and fieldDef are both empty.")}}function l(t,e,i){var o=w(),n=u(e,i);n&&0!==n.length&&(b(o,n),_(t,i),C(i),d3.select("#vis-tooltip").style("visibility","visible"),F=!0,i.onAppear&&i.onAppear(t,e))}function r(t,e,i){_(t,i),i.onMove&&i.onMove(t,e)}function a(t,e,i){d3.select("#vis-tooltip").style("visibility","hidden"),F=!1,T(),D(),x(),i.onDisappear&&i.onDisappear(t,e)}function f(t){return!(!t||!t.datum)&&(!t.datum._facetID&&!!t.datum._id)}function u(t,e){var i=d3.map(t.datum);return p(i,["_id","_prev","count_start","count_end","layout_start","layout_mid","layout_end","layout_path","layout_x","layout_y"]),m(i,e.fields),v(i,e.fields),g(t.mark.marktype,i),!1!==e.showAllFields?c(i,e):d(i,e)}function d(t,e){var i=[];return e.fields.forEach(function(e){var o=e.title?e.title:e.field,n=s(t,e.field);if(void 0!==n){var l=h(n,e.formatType,e.format)||y(n);i.push({title:o,value:l})}}),i}function s(t,e){var i,o=e.split("."),n=o[0];return o.shift(),t.has(n)&&(i=t.get(n),o.forEach(function(t){i[t]&&(i=i[t])})),void 0===i?void console.warn("[Tooltip] Cannot find field "+e+" in data."):i}function c(t,e){var i=[],o=d3.map(e.fields,function(t){return t.field});return t.forEach(function(t,e){var n;if(n=o.has(t)&&o.get(t).title?o.get(t).title:t,o.has(t))var l=o.get(t).formatType,r=o.get(t).format;var a=h(e,l,r)||y(e);i.push({title:n,value:a})}),i}function p(t,e){e.forEach(function(e){t.remove(e)})}function m(t,e){e&&e.forEach(function(e){e.removeOriginalTemporalField&&p(t,[e.removeOriginalTemporalField])})}function v(t,e){if(e)return e.forEach(function(e){if(!0===e.bin){var i=e.field,o=i.replace("_range","_start"),n=i.replace("_range","_mid"),l=i.replace("_range","_end"),r=t.get(o),a=t.get(l);if(void 0!==r&&void 0!==a){var f=r+"-"+a;t.set(i,f)}var u=[];u.push(o,n,l),p(t,u)}}),t}function g(t,e){if("line"===t||"area"===t){var i=[];e.forEach(function(t,e){switch(dl.type(e)){case"number":case"date":i.push(t)}}),p(e,i)}}function h(t,e,i){if(void 0!==t&&null!==t&&e)switch(e){case"time":return i?dl.format.time(i)(t):dl.format.auto.time()(t);case"number":return i?dl.format.number(i)(t):dl.format.auto.number()(t);case"string":default:return t}}function y(t){switch(dl.type(t)){case"date":return dl.format.auto.time()(t);case"number":return dl.format.auto.number()(t);case"boolean":case"string":default:return t}}function w(){return d3.select("#vis-tooltip").empty()?d3.select("body").append("div").attr("id","vis-tooltip").attr("class","vg-tooltip"):d3.select("#vis-tooltip")}function b(t,e){t.selectAll("table").remove();var i=t.append("table").selectAll(".tooltip-row").data(e);i.exit().remove();var o=i.enter().append("tr").attr("class","tooltip-row");o.append("td").attr("class","key").text(function(t){return t.title+":"}),o.append("td").attr("class","value").text(function(t){return t.value})}function T(){d3.select("#vis-tooltip").selectAll(".tooltip-row").data([]).exit().remove()}function _(t,e){var i=10,o=10;e&&e.offset&&void 0!==e.offset.x&&null!==e.offset.x&&(i=e.offset.x),e&&e.offset&&void 0!==e.offset.y&&null!==e.offset.y&&(o=e.offset.y),d3.select("#vis-tooltip").style("top",function(){var e=this.getBoundingClientRect().height;return t.clientY+e+o<window.innerHeight?t.clientY+o+"px":t.clientY-e-o+"px"}).style("left",function(){var e=this.getBoundingClientRect().width;return t.clientX+e+i<window.innerWidth?t.clientX+i+"px":t.clientX-e-i+"px"})}function x(){d3.select("#vis-tooltip").style("top","-9999px").style("left","-9999px")}function C(t){D(),t&&"dark"===t.colorTheme?d3.select("#vis-tooltip").classed("dark-theme",!0):d3.select("#vis-tooltip").classed("light-theme",!0)}function D(){d3.select("#vis-tooltip").classed("dark-theme light-theme",!1)}var E=void 0,F=!1;window.vg=window.vg||{},window.vg.tooltip=function(e,i){return i||(i={}),e.on("mouseover.tooltipInit",function(e,o){f(o)&&(t(),E=window.setTimeout(function(){l(e,o,i)},i.delay||100))}),e.on("mousemove.tooltipUpdate",function(t,e){f(e)&&F&&r(t,e,i)}),e.on("mouseout.tooltipClear",function(e,o){f(o)&&(t(),F&&a(e,o,i))}),{destroy:function(){e.off("mouseover.tooltipInit"),e.off("mousemove.tooltipUpdate"),e.off("mouseout.tooltipClear"),t()}}},window.vl=window.vl||{},window.vl.tooltip=function(i,o,n){return n||(n={}),n=e(n,o),i.on("mouseover.tooltipInit",function(e,i){f(i)&&(t(),E=window.setTimeout(function(){l(e,i,n)},n.delay||100))}),i.on("mousemove.tooltipUpdate",function(t,e){f(e)&&F&&r(t,e,n)}),i.on("mouseout.tooltipClear",function(e,i){f(i)&&(t(),F&&a(e,i,n))}),{destroy:function(){i.off("mouseover.tooltipInit"),i.off("mousemove.tooltipUpdate"),i.off("mouseout.tooltipClear"),t()}}};var U={quantitative:"number",temporal:"time",ordinal:void 0,nominal:void 0}}();
